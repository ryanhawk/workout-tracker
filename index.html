<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Tracker">
<title>Workout Tracker</title>
<style>
:root{--bg:#0a0a0a;--card:#1a1a1a;--card2:#222;--bdr:#2a2a2a;--txt:#e8e8e8;--dim:#888;--dim2:#555;--acc:#ff6b35;--acc2:#ff6b3520;--grn:#4ade80;--grn2:#4ade8020;--blu:#60a5fa;--blu2:#60a5fa20;--red:#f87171;--ylw:#fbbf24}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,'SF Pro Text',sans-serif;background:var(--bg);color:var(--txt);min-height:100vh;padding-bottom:70px;overscroll-behavior:none}
input,select,button,textarea{font-family:inherit}

/* Header */
.hdr{position:sticky;top:0;z-index:100;background:rgba(10,10,10,.92);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);padding:10px 16px 0;border-bottom:1px solid var(--bdr)}
.hdr h1{font-size:18px;font-weight:700}
.hdr .sub{font-size:11px;color:var(--dim);margin-bottom:8px}

/* Main nav */
.nav{display:flex;gap:0;border-bottom:1px solid var(--bdr);margin:0 -16px;padding:0 16px}
.nav-btn{flex:1;padding:8px 0;font-size:12px;font-weight:600;color:var(--dim);text-align:center;cursor:pointer;border-bottom:2px solid transparent;transition:.2s}
.nav-btn.active{color:var(--acc);border-bottom-color:var(--acc)}

/* Week + Day selectors */
.wk-row{display:flex;gap:6px;padding:10px 16px 0}
.wk-btn{flex:1;padding:5px 0;border:1px solid var(--bdr);border-radius:8px;background:var(--card);color:var(--dim);font-size:11px;font-weight:600;cursor:pointer;text-align:center}
.wk-btn.active{background:var(--acc);color:#fff;border-color:var(--acc)}
.day-row{display:flex;gap:2px;padding:6px 16px;overflow-x:auto;scrollbar-width:none}
.day-row::-webkit-scrollbar{display:none}
.day-btn{padding:6px 12px;font-size:12px;font-weight:600;color:var(--dim);cursor:pointer;border-bottom:2px solid transparent;white-space:nowrap}
.day-btn.active{color:var(--acc);border-bottom-color:var(--acc)}
.day-btn.done{color:var(--grn)}

/* Content */
.page{padding:16px;display:none}
.page.show{display:block}
.day-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.day-ttl{font-size:17px;font-weight:700}
.day-loc{font-size:11px;color:var(--dim);background:var(--card);padding:3px 10px;border-radius:12px}
.sec-lbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--acc);margin:18px 0 8px}

/* Exercise card */
.ex-card{background:var(--card);border:1px solid var(--bdr);border-radius:12px;padding:12px;margin-bottom:8px;overflow:hidden}
.ex-card.done{border-color:var(--grn);background:var(--grn2)}
.ex-top{display:flex;gap:10px;align-items:flex-start;overflow:hidden}
.chk{width:24px;height:24px;border:2px solid var(--bdr);border-radius:50%;flex-shrink:0;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s;margin-top:1px}
.chk.done{background:var(--grn);border-color:var(--grn)}
.chk.done::after{content:'‚úì';color:#000;font-size:13px;font-weight:700}
.ex-info{flex:1;min-width:0;overflow:hidden}
.ex-nm{font-size:14px;font-weight:600;margin-bottom:3px}
.ex-card.done .ex-nm{text-decoration:line-through;color:var(--dim)}
.ex-meta{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:3px}
.tag{font-size:10px;padding:2px 7px;border-radius:5px;background:rgba(255,255,255,.06);color:var(--dim)}
.tag.s{color:var(--blu);background:var(--blu2)}
.tag.r{color:var(--acc);background:var(--acc2)}
.ex-note{font-size:11px;color:var(--dim);line-height:1.3;margin-top:4px}

/* Set logging */
.sets-log{margin-top:8px;width:100%;overflow:hidden}
.set-row{display:flex;align-items:center;gap:6px;margin-bottom:5px;width:100%}
.set-num{width:22px;height:22px;border-radius:50%;border:1.5px solid var(--bdr);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:600;color:var(--dim);cursor:pointer;flex-shrink:0;transition:.15s}
.set-num.done{background:var(--acc);border-color:var(--acc);color:#fff}
.set-input{flex:1;min-width:0;height:30px;background:var(--card2);border:1px solid var(--bdr);border-radius:6px;color:var(--txt);font-size:12px;padding:0 8px;text-align:center;outline:none}
.set-input:focus{border-color:var(--acc)}
.set-input::placeholder{color:var(--dim2)}
.set-lbl{font-size:9px;color:var(--dim);text-align:center;width:60px;flex-shrink:0}
.set-hdr{display:flex;gap:6px;margin-bottom:4px;padding-left:28px;width:100%}
.set-hdr span{flex:1;font-size:9px;color:var(--dim2);text-align:center}

/* Note block */
.note-blk{background:var(--acc2);border-left:3px solid var(--acc);border-radius:0 8px 8px 0;padding:10px 12px;margin-bottom:10px;font-size:11px;line-height:1.4}

/* Cardio toggle */
.cardio-tog{display:flex;gap:8px;margin-bottom:10px}
.c-opt{flex:1;padding:8px;border:1px solid var(--bdr);border-radius:10px;background:var(--card);text-align:center;cursor:pointer;font-size:11px;font-weight:600;color:var(--dim)}
.c-opt.active{border-color:var(--acc);color:var(--acc);background:var(--acc2)}

/* Rest day */
.rest-msg{text-align:center;padding:50px 20px;color:var(--dim)}
.rest-msg .emo{font-size:44px;margin-bottom:14px}
.rest-msg h2{color:var(--txt);margin-bottom:6px;font-size:18px}
.rest-msg p{font-size:13px;line-height:1.5}

/* Bottom bar */
.bot{position:fixed;bottom:0;left:0;right:0;z-index:100;background:rgba(10,10,10,.95);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);padding:8px 16px 12px;border-top:1px solid var(--bdr)}
.prog-track{height:5px;background:var(--card);border-radius:3px;overflow:hidden;margin-bottom:4px}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--acc),var(--grn));border-radius:3px;transition:width .3s}
.prog-txt{font-size:11px;color:var(--dim);text-align:center}

/* PR Page */
.pr-card{background:var(--card);border:1px solid var(--bdr);border-radius:12px;padding:14px;margin-bottom:10px}
.pr-title{font-size:14px;font-weight:700;margin-bottom:8px}
.pr-current{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.pr-val{font-size:28px;font-weight:800;color:var(--acc)}
.pr-target{font-size:12px;color:var(--dim)}
.pr-form{display:flex;gap:6px;margin-bottom:8px}
.pr-input{flex:1;height:36px;background:var(--card2);border:1px solid var(--bdr);border-radius:8px;color:var(--txt);font-size:14px;padding:0 10px;outline:none}
.pr-input:focus{border-color:var(--acc)}
.pr-btn{height:36px;padding:0 16px;background:var(--acc);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer}
.pr-history{max-height:120px;overflow-y:auto}
.pr-entry{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--bdr);font-size:12px}
.pr-entry .date{color:var(--dim)}
.pr-entry .val{font-weight:600}
.pr-entry .val.up{color:var(--grn)}

/* Progress/Charts page */
.chart-card{background:var(--card);border:1px solid var(--bdr);border-radius:12px;padding:14px;margin-bottom:12px}
.chart-title{font-size:13px;font-weight:700;margin-bottom:10px}
.chart-wrap{position:relative;width:100%;height:180px}
.chart-wrap canvas{width:100%!important;height:100%!important}
.no-data{text-align:center;padding:40px 20px;color:var(--dim);font-size:13px}

/* Summary page */
.sum-card{background:var(--card);border:1px solid var(--bdr);border-radius:12px;padding:14px;margin-bottom:10px}
.sum-title{font-size:13px;font-weight:700;margin-bottom:8px;color:var(--acc)}
.sum-stat{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--bdr);font-size:13px}
.sum-stat:last-child{border:none}
.sum-stat .label{color:var(--dim)}
.sum-stat .value{font-weight:600}
.sum-pr{display:inline-block;background:var(--ylw);color:#000;font-size:10px;font-weight:700;padding:1px 6px;border-radius:4px;margin-left:6px}

/* Buttons */
.btn-red{display:block;width:100%;padding:10px;margin-top:16px;background:var(--card);border:1px solid var(--red);border-radius:10px;color:var(--red);font-size:13px;font-weight:600;cursor:pointer}
.btn-dim{display:block;width:100%;padding:10px;margin-top:8px;background:var(--card);border:1px solid var(--bdr);border-radius:10px;color:var(--dim);font-size:13px;font-weight:600;cursor:pointer}

/* Body comp form */
.bc-form{display:flex;gap:8px;margin-bottom:10px}
.bc-input{flex:1;height:36px;background:var(--card2);border:1px solid var(--bdr);border-radius:8px;color:var(--txt);font-size:14px;padding:0 10px;outline:none}
.bc-input:focus{border-color:var(--acc)}
</style>
</head>
<body>

<div class="hdr">
  <h1>Workout Tracker</h1>
  <div class="sub">Weeks 1‚Äì4 Foundation Phase</div>
  <div class="nav" id="mainNav"></div>
</div>

<div id="workoutHeader"></div>
<div class="page" id="workoutPage"></div>
<div class="page" id="prPage"></div>
<div class="page" id="progressPage"></div>
<div class="page" id="summaryPage"></div>

<div class="bot">
  <div class="prog-track"><div class="prog-fill" id="progFill"></div></div>
  <div class="prog-txt" id="progTxt"></div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ
const DAYS=[
{id:'mon',label:'Mon',title:'Pull + Core + Forearms',loc:'Home Gym',sections:[
{name:'Main Work',exercises:[
{name:'Strict Pull-Ups',sets:5,reps:'Progression',rpe:'8-9',rest:'90s',note:'Wk1-2: sets of 3. Wk3-4: push set 1 for max, fill volume.',track:true},
{name:'Barbell Bent-Over Row',sets:4,reps:'8-10',rpe:'7-8',rest:'90s',note:'Overhand grip. Brace core.',track:true},
{name:'KB Single-Arm Row',sets:3,reps:'10-12 ea',rpe:'7',rest:'60s',note:'45-53 lb KB.',track:true}]},
{name:'Forearm / Rehab',exercises:[
{name:'Wrist Roller',sets:3,reps:'2 rolls',rest:'60s',note:'Flexion + extension.',track:false},
{name:'Twist Yo Wrist',sets:3,reps:'8-10 ea dir',rest:'60s',note:'Start light.',track:false},
{name:'I-Bell Holds',sets:3,reps:'30s ea hand',rest:'45s',note:'5-10 lb plate.',track:false},
{name:'Fat Gripz Curl',sets:3,reps:'10-12',rest:'60s',note:'Thick grip is the stimulus.',track:true}]},
{name:'Core Stability',exercises:[
{name:'GHD Back Extension',sets:3,reps:'12',rest:'60s',note:'3s eccentric.',track:false},
{name:'Dead Bug',sets:3,reps:'8 ea side',rest:'45s',note:'Low back into floor.',track:false},
{name:'Pallof Press',sets:3,reps:'10 ea side',rest:'45s',note:'Anti-rotation.',track:false}]}
]},
{id:'tue',label:'Tue',title:'Cardio + Core Circuit',loc:'Gym or Home',hasCardio:true,
cardioOpts:[
{id:'gym',label:'Gym',exercises:[
{name:'Stair Stepper Warm-Up',sets:1,reps:'3 min',note:'Easy.',track:false},
{name:'Stair Stepper HIIT/Mountain',sets:1,reps:'20-25 min',note:'HR 140-160.',track:false},
{name:'Stair Stepper Cool-Down',sets:1,reps:'2 min',note:'Easy.',track:false}]},
{id:'home',label:'Home',exercises:[
{name:'Echo Bike Warm-Up',sets:1,reps:'2 min',note:'Easy.',track:false},
{name:'Intervals 30s ON/30s OFF',sets:1,reps:'8-10 rnds',note:'All-out.',track:false},
{name:'Cool-Down',sets:1,reps:'3 min',note:'Easy.',track:false}]}],
sections:[
{name:'Core Circuit ‚Äî 3 Rounds',exercises:[
{name:'GHD Sit-Up / Ab Wheel',sets:3,reps:'10',note:'Controlled.',track:false},
{name:'Bird Dog',sets:3,reps:'8 ea side',note:'Hold top 2s.',track:false},
{name:'Plank Shoulder Taps',sets:3,reps:'12 ea side',note:'Resist hip rotation.',track:false},
{name:'Banded Pallof Hold',sets:3,reps:'20s ea side',note:'Step further each week.',track:false}]}
]},
{id:'wed',label:'Wed',title:'REST',isRest:true,msg:'Recovery day. Let Mon/Tue settle before Thursday PT.'},
{id:'thu',label:'Thu',title:'PT ‚Äî Upper Body',loc:'Gym w/ Trainer',sections:[
{name:'Trainer Programmed',note:'Follow trainer. Log weights below.',exercises:[]},
{name:'Log PT Exercises',isPTLog:true,exercises:[
{name:'PT Exercise 1',sets:4,reps:'‚Äî',note:'Tap name to edit.',track:true,editable:true},
{name:'PT Exercise 2',sets:4,reps:'‚Äî',note:'Tap name to edit.',track:true,editable:true},
{name:'PT Exercise 3',sets:3,reps:'‚Äî',note:'Tap name to edit.',track:true,editable:true}]},
{name:'Add-On (5 min)',exercises:[
{name:'Twist Yo Wrist',sets:2,reps:'8 ea dir',note:'Forearm frequency.',track:false},
{name:'Band Pull-Aparts',sets:2,reps:'15',note:'Rear delt health.',track:false}]}
]},
{id:'fri',label:'Fri',title:'PT ‚Äî Legs',loc:'Gym w/ Trainer',sections:[
{name:'Trainer Programmed',note:'Follow trainer. Log weights below.',exercises:[]},
{name:'Log PT Exercises',isPTLog:true,exercises:[
{name:'PT Exercise 1',sets:4,reps:'‚Äî',note:'Tap name to edit.',track:true,editable:true},
{name:'PT Exercise 2',sets:4,reps:'‚Äî',note:'Tap name to edit.',track:true,editable:true},
{name:'PT Exercise 3',sets:3,reps:'‚Äî',note:'Tap name to edit.',track:true,editable:true}]},
{name:'Add-On (5 min)',exercises:[
{name:'GHD Hip Extension',sets:2,reps:'12',note:'Light, controlled.',track:false},
{name:'I-Bell Rotations',sets:2,reps:'20s ea hand',note:'Forearm frequency.',track:false}]}
]},
{id:'sat',label:'Sat',title:'Supplemental + Cardio',loc:'Home Gym',sections:[
{name:'Bench Accessories',exercises:[
{name:'Close-Grip Bench',sets:4,reps:'6-8',rpe:'7-8',rest:'2 min',note:'Start ~215 lbs.',track:true},
{name:'DB Incline Press',sets:3,reps:'10-12',rpe:'7',rest:'90s',note:'Bowflex DBs.',track:true},
{name:'KB Floor Press',sets:3,reps:'10 ea arm',rpe:'7',rest:'60s',note:'45 lb KB.',track:true}]},
{name:'Posterior Chain + Core',exercises:[
{name:'KB Swing',sets:4,reps:'15',rpe:'7',rest:'60s',note:'53-70 lb KB.',track:true},
{name:'GHD Back Extension',sets:3,reps:'12',rpe:'7',rest:'60s',note:'Slow eccentrics.',track:false},
{name:'Suitcase Carry',sets:3,reps:'40 yd ea',rest:'60s',note:'53-70 lb KB.',track:false}]},
{name:'Cardio Finisher',exercises:[
{name:'Echo Bike',sets:1,reps:'10 min intervals',note:'20s hard / 40s easy.',track:false},
{name:'‚Äî OR Rower',sets:1,reps:'2,000m',note:'Track time.',track:false},
{name:'‚Äî OR Jump Rope',sets:5,reps:'1 min on/30s off',note:'Conditioning.',track:false}]}
]},
{id:'sun',label:'Sun',title:'Active Recovery',isRest:true,msg:'Ruck if weather is good (30-45 min, 20-35 lb). Otherwise walk/stretch.'}
];

const PR_LIFTS=[
{id:'bench',name:'Bench Press',unit:'lbs',current:305,target:325},
{id:'deadlift',name:'Deadlift',unit:'lbs',current:365,target:400},
{id:'pullups',name:'Strict Pull-Ups',unit:'reps',current:4,target:10},
{id:'weight',name:'Body Weight',unit:'lbs',current:225,target:null},
{id:'bodyfat',name:'Body Fat %',unit:'%',current:21,target:15}
];

const TABS=[{id:'workout',label:'Workout'},{id:'pr',label:'PRs'},{id:'progress',label:'Progress'},{id:'summary',label:'Summary'}];

let curTab='workout',curWeek=1,curDay=0,state={};

// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ
function load(){try{const s=localStorage.getItem('wt-v2');if(s)state=JSON.parse(s);else state={}}catch(e){state={}}}
function save(){try{localStorage.setItem('wt-v2',JSON.stringify(state))}catch(e){}}
function k(w,d,si,ei,t){return`w${w}_${d}_s${si}_e${ei}_${t}`}
function sk(w,d,si,ei,s,t){return`w${w}_${d}_s${si}_e${ei}_set${s}_${t}`}

// ‚îÄ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ
function render(){
  renderNav();
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('show'));
  document.getElementById('workoutHeader').innerHTML='';
  if(curTab==='workout'){renderWorkoutHeader();renderWorkout();document.getElementById('workoutPage').classList.add('show')}
  else if(curTab==='pr'){renderPR();document.getElementById('prPage').classList.add('show')}
  else if(curTab==='progress'){renderProgress();document.getElementById('progressPage').classList.add('show')}
  else if(curTab==='summary'){renderSummary();document.getElementById('summaryPage').classList.add('show')}
  updateBot();
}

function renderNav(){
  const el=document.getElementById('mainNav');
  el.innerHTML=TABS.map(t=>`<div class="nav-btn ${t.id===curTab?'active':''}" onclick="curTab='${t.id}';render()">${t.label}</div>`).join('');
}

function renderWorkoutHeader(){
  const el=document.getElementById('workoutHeader');
  let h=`<div class="wk-row">`;
  for(let w=1;w<=4;w++)h+=`<div class="wk-btn ${w===curWeek?'active':''}" onclick="curWeek=${w};render()">Wk ${w}</div>`;
  h+=`</div><div class="day-row">`;
  DAYS.forEach((d,i)=>{
    const dn=isDayDone(d)?'done':'';
    h+=`<div class="day-btn ${i===curDay?'active':''} ${dn}" onclick="curDay=${i};render()">${d.label}</div>`;
  });
  h+=`</div>`;
  el.innerHTML=h;
}

function isDayDone(d){
  if(d.isRest)return false;
  const secs=getSecs(d);let t=0,c=0;
  secs.forEach((s,si)=>s.exercises.forEach((e,ei)=>{t++;if(state[k(curWeek,d.id,si,ei,'done')])c++}));
  return t>0&&c===t;
}

function getSecs(d){
  let s=[];
  if(d.hasCardio){
    const opt=state[`w${curWeek}_${d.id}_copt`]||'gym';
    const co=d.cardioOpts.find(o=>o.id===opt);
    if(co)s.push({name:'Cardio ‚Äî '+co.label,exercises:co.exercises});
  }
  if(d.sections)s=s.concat(d.sections);
  return s;
}

function renderWorkout(){
  const el=document.getElementById('workoutPage');
  const d=DAYS[curDay];
  if(d.isRest){el.innerHTML=`<div class="rest-msg"><div class="emo">${d.id==='wed'?'üò¥':'üö∂‚Äç‚ôÇÔ∏è'}</div><h2>${d.title}</h2><p>${d.msg}</p></div>`;return}
  let h=`<div class="day-hdr"><div class="day-ttl">${d.title}</div><div class="day-loc">${d.loc}</div></div>`;
  if(d.hasCardio){
    const opt=state[`w${curWeek}_${d.id}_copt`]||'gym';
    h+=`<div class="cardio-tog">${d.cardioOpts.map(o=>`<div class="c-opt ${o.id===opt?'active':''}" onclick="state['w${curWeek}_${d.id}_copt']='${o.id}';save();render()">${o.label}</div>`).join('')}</div>`;
  }
  const secs=getSecs(d);
  secs.forEach((sec,si)=>{
    h+=`<div class="sec-lbl">${sec.name}</div>`;
    if(sec.note&&sec.exercises.length===0)h+=`<div class="note-blk">${sec.note}</div>`;
    sec.exercises.forEach((ex,ei)=>{
      const done=!!state[k(curWeek,d.id,si,ei,'done')];
      const eName=state[k(curWeek,d.id,si,ei,'customName')]||ex.name;
      h+=`<div class="ex-card ${done?'done':''}">`;
      h+=`<div class="ex-top">`;
      h+=`<div class="chk ${done?'done':''}" onclick="togEx('${d.id}',${si},${ei})"></div>`;
      h+=`<div class="ex-info">`;
      if(ex.editable){
        h+=`<input class="set-input" style="font-weight:600;font-size:14px;text-align:left;margin-bottom:4px;width:100%" value="${eName}" onchange="renameEx('${d.id}',${si},${ei},this.value)" placeholder="Exercise name">`;
      } else {
        h+=`<div class="ex-nm">${eName}</div>`;
      }
      h+=`<div class="ex-meta">`;
      if(ex.sets)h+=`<span class="tag s">${ex.sets}√ó${ex.reps}</span>`;
      if(ex.rpe)h+=`<span class="tag r">RPE ${ex.rpe}</span>`;
      if(ex.rest)h+=`<span class="tag">Rest ${ex.rest}</span>`;
      h+=`</div>`;
      if(ex.note&&!ex.editable)h+=`<div class="ex-note">${ex.note}</div>`;

      // Set-by-set logging
      if(ex.sets>1&&ex.track){
        h+=`<div class="sets-log">`;
        h+=`<div class="set-hdr"><span style="width:22px"></span><span>Weight</span><span>Reps</span></div>`;
        for(let s=1;s<=ex.sets;s++){
          const sd=!!state[sk(curWeek,d.id,si,ei,s,'done')];
          const wt=state[sk(curWeek,d.id,si,ei,s,'wt')]||'';
          const rp=state[sk(curWeek,d.id,si,ei,s,'rp')]||'';
          h+=`<div class="set-row">`;
          h+=`<div class="set-num ${sd?'done':''}" onclick="togSet('${d.id}',${si},${ei},${s})">${s}</div>`;
          h+=`<input class="set-input" type="number" inputmode="decimal" placeholder="lbs" value="${wt}" onchange="logSet('${d.id}',${si},${ei},${s},'wt',this.value)">`;
          h+=`<input class="set-input" type="number" inputmode="numeric" placeholder="reps" value="${rp}" onchange="logSet('${d.id}',${si},${ei},${s},'rp',this.value)">`;
          h+=`</div>`;
        }
        h+=`</div>`;
      } else if(ex.sets===1&&ex.track){
        const wt=state[sk(curWeek,d.id,si,ei,1,'wt')]||'';
        const rp=state[sk(curWeek,d.id,si,ei,1,'rp')]||'';
        h+=`<div class="sets-log"><div class="set-hdr"><span>Weight</span><span>Reps/Time</span></div>`;
        h+=`<div class="set-row">`;
        h+=`<input class="set-input" type="number" inputmode="decimal" placeholder="lbs" value="${wt}" onchange="logSet('${d.id}',${si},${ei},1,'wt',this.value)">`;
        h+=`<input class="set-input" inputmode="text" placeholder="reps" value="${rp}" onchange="logSet('${d.id}',${si},${ei},1,'rp',this.value)">`;
        h+=`</div></div>`;
      }
      h+=`</div></div></div>`;
    });
  });
  h+=`<button class="btn-red" onclick="resetDay('${d.id}')">Reset ${d.label} Checkboxes</button>`;
  h+=`<button class="btn-dim" onclick="resetDayAll('${d.id}')">Reset ${d.label} All Data</button>`;
  el.innerHTML=h;
}

// ‚îÄ‚îÄ‚îÄ WORKOUT ACTIONS ‚îÄ‚îÄ‚îÄ
function togEx(did,si,ei){
  const d=DAYS.find(x=>x.id===did);
  const key=k(curWeek,did,si,ei,'done');
  state[key]=!state[key];
  const secs=getSecs(d);const ex=secs[si]?.exercises[ei];
  if(ex&&ex.sets>1){for(let s=1;s<=ex.sets;s++)state[sk(curWeek,did,si,ei,s,'done')]=state[key]}
  save();render();
}
function togSet(did,si,ei,s){
  const key=sk(curWeek,did,si,ei,s,'done');
  state[key]=!state[key];
  const d=DAYS.find(x=>x.id===did);const secs=getSecs(d);const ex=secs[si]?.exercises[ei];
  if(ex){let all=true;for(let i=1;i<=ex.sets;i++){if(!state[sk(curWeek,did,si,ei,i,'done')]){all=false;break}}state[k(curWeek,did,si,ei,'done')]=all}
  save();render();
}
function logSet(did,si,ei,s,type,val){state[sk(curWeek,did,si,ei,s,type)]=val;save()}
function renameEx(did,si,ei,val){state[k(curWeek,did,si,ei,'customName')]=val;save()}
function resetDay(did){Object.keys(state).filter(x=>x.startsWith(`w${curWeek}_${did}_`)&&(x.endsWith('_done'))).forEach(x=>delete state[x]);save();render()}
function resetDayAll(did){Object.keys(state).filter(x=>x.startsWith(`w${curWeek}_${did}_`)).forEach(x=>delete state[x]);save();render()}

// ‚îÄ‚îÄ‚îÄ PR PAGE ‚îÄ‚îÄ‚îÄ
function renderPR(){
  const el=document.getElementById('prPage');
  let h='';
  PR_LIFTS.forEach(lift=>{
    const history=state[`pr_${lift.id}`]||[];
    const latest=history.length?history[history.length-1].val:lift.current;
    h+=`<div class="pr-card">`;
    h+=`<div class="pr-title">${lift.name}</div>`;
    h+=`<div class="pr-current"><div class="pr-val">${latest} <span style="font-size:14px;color:var(--dim)">${lift.unit}</span></div>`;
    if(lift.target)h+=`<div class="pr-target">Target: ${lift.target} ${lift.unit}</div>`;
    h+=`</div>`;
    h+=`<div class="pr-form"><input class="pr-input" id="pr_in_${lift.id}" type="number" inputmode="decimal" placeholder="New ${lift.unit}"><button class="pr-btn" onclick="logPR('${lift.id}')">Log</button></div>`;
    if(history.length){
      h+=`<div class="pr-history">`;
      [...history].reverse().forEach((e,i)=>{
        const prev=i<history.length-1?[...history].reverse()[i+1]:null;
        const isUp=prev&&e.val>prev.val;
        h+=`<div class="pr-entry"><span class="date">${e.date}</span><span class="val ${isUp?'up':''}">${e.val} ${lift.unit}${isUp?' ‚Üë':''}</span></div>`;
      });
      h+=`</div>`;
    }
    h+=`</div>`;
  });
  el.innerHTML=h;
}

function logPR(id){
  const input=document.getElementById(`pr_in_${id}`);
  const val=parseFloat(input.value);
  if(isNaN(val))return;
  if(!state[`pr_${id}`])state[`pr_${id}`]=[];
  const today=new Date();
  const dateStr=`${today.getMonth()+1}/${today.getDate()}/${today.getFullYear()}`;
  state[`pr_${id}`].push({val,date:dateStr,week:curWeek});
  save();input.value='';render();
}

// ‚îÄ‚îÄ‚îÄ PROGRESS PAGE ‚îÄ‚îÄ‚îÄ
function renderProgress(){
  const el=document.getElementById('progressPage');
  let h='';
  PR_LIFTS.forEach(lift=>{
    const history=state[`pr_${lift.id}`]||[];
    h+=`<div class="chart-card"><div class="chart-title">${lift.name} (${lift.unit})</div>`;
    if(history.length<2){
      h+=`<div class="no-data">Log at least 2 entries in PRs to see a chart</div>`;
    } else {
      h+=`<div class="chart-wrap"><canvas id="chart_${lift.id}"></canvas></div>`;
    }
    h+=`</div>`;
  });

  // Volume chart
  h+=`<div class="chart-card"><div class="chart-title">Weekly Volume (Total Sets Completed)</div><div class="chart-wrap"><canvas id="chart_volume"></canvas></div></div>`;

  el.innerHTML=h;

  // Draw charts
  PR_LIFTS.forEach(lift=>{
    const history=state[`pr_${lift.id}`]||[];
    if(history.length>=2)drawChart(`chart_${lift.id}`,history.map(e=>e.val),history.map(e=>e.date),lift.target);
  });
  drawVolumeChart();
}

function drawChart(canvasId,values,labels,target){
  const canvas=document.getElementById(canvasId);
  if(!canvas)return;
  const ctx=canvas.getContext('2d');
  const dpr=window.devicePixelRatio||1;
  const rect=canvas.parentElement.getBoundingClientRect();
  canvas.width=rect.width*dpr;canvas.height=rect.height*dpr;
  ctx.scale(dpr,dpr);
  const W=rect.width,H=rect.height;
  const pad={t:10,r:10,b:30,l:45};
  const gW=W-pad.l-pad.r,gH=H-pad.t-pad.b;
  const mn=Math.min(...values)*0.95,mx=Math.max(...values,target||0)*1.05;

  ctx.fillStyle='#888';ctx.font='10px -apple-system,sans-serif';ctx.textAlign='right';
  for(let i=0;i<=4;i++){
    const v=mn+(mx-mn)*(i/4);const y=pad.t+gH-(i/4)*gH;
    ctx.fillText(Math.round(v),pad.l-6,y+3);
    ctx.strokeStyle='#2a2a2a';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(W-pad.r,y);ctx.stroke();
  }

  // Target line
  if(target){
    const ty=pad.t+gH-((target-mn)/(mx-mn))*gH;
    ctx.strokeStyle='#4ade8060';ctx.lineWidth=1;ctx.setLineDash([4,4]);ctx.beginPath();ctx.moveTo(pad.l,ty);ctx.lineTo(W-pad.r,ty);ctx.stroke();ctx.setLineDash([]);
    ctx.fillStyle='#4ade80';ctx.font='9px -apple-system,sans-serif';ctx.textAlign='left';ctx.fillText('Target',W-pad.r-30,ty-4);
  }

  // Line
  ctx.strokeStyle='#ff6b35';ctx.lineWidth=2;ctx.beginPath();
  values.forEach((v,i)=>{
    const x=pad.l+(i/(values.length-1))*gW;
    const y=pad.t+gH-((v-mn)/(mx-mn))*gH;
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  });
  ctx.stroke();

  // Dots
  values.forEach((v,i)=>{
    const x=pad.l+(i/(values.length-1))*gW;
    const y=pad.t+gH-((v-mn)/(mx-mn))*gH;
    ctx.fillStyle='#ff6b35';ctx.beginPath();ctx.arc(x,y,4,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='#e8e8e8';ctx.font='10px -apple-system,sans-serif';ctx.textAlign='center';ctx.fillText(v,x,y-8);
  });

  // X labels
  ctx.fillStyle='#888';ctx.font='9px -apple-system,sans-serif';ctx.textAlign='center';
  labels.forEach((l,i)=>{
    const x=pad.l+(i/(labels.length-1))*gW;
    ctx.fillText(l,x,H-6);
  });
}

function drawVolumeChart(){
  const canvas=document.getElementById('chart_volume');
  if(!canvas)return;
  const ctx=canvas.getContext('2d');
  const dpr=window.devicePixelRatio||1;
  const rect=canvas.parentElement.getBoundingClientRect();
  canvas.width=rect.width*dpr;canvas.height=rect.height*dpr;
  ctx.scale(dpr,dpr);
  const W=rect.width,H=rect.height;
  const pad={t:10,r:10,b:30,l:45};
  const gW=W-pad.l-pad.r,gH=H-pad.t-pad.b;

  // Calculate sets completed per week
  const vols=[];
  for(let w=1;w<=4;w++){
    let sets=0;
    DAYS.forEach(d=>{
      if(d.isRest)return;
      const secs=getAllSecsForWeek(d,w);
      secs.forEach((sec,si)=>{
        sec.exercises.forEach((ex,ei)=>{
          if(ex.sets>1){
            for(let s=1;s<=ex.sets;s++){if(state[sk(w,d.id,si,ei,s,'done')])sets++}
          } else {
            if(state[k(w,d.id,si,ei,'done')])sets++;
          }
        });
      });
    });
    vols.push(sets);
  }

  const mx=Math.max(...vols,1)*1.2;
  const barW=gW/4*0.6;
  const gap=gW/4;

  ctx.fillStyle='#888';ctx.font='10px -apple-system,sans-serif';ctx.textAlign='right';
  for(let i=0;i<=4;i++){
    const v=Math.round(mx*(i/4));const y=pad.t+gH-(i/4)*gH;
    ctx.fillText(v,pad.l-6,y+3);
    ctx.strokeStyle='#2a2a2a';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(W-pad.r,y);ctx.stroke();
  }

  vols.forEach((v,i)=>{
    const x=pad.l+gap*i+gap/2-barW/2;
    const bH=mx>0?(v/mx)*gH:0;
    const y=pad.t+gH-bH;
    const grad=ctx.createLinearGradient(x,y,x,pad.t+gH);
    grad.addColorStop(0,'#ff6b35');grad.addColorStop(1,'#ff6b3540');
    ctx.fillStyle=grad;
    ctx.beginPath();ctx.roundRect(x,y,barW,bH,4);ctx.fill();
    ctx.fillStyle='#e8e8e8';ctx.font='11px -apple-system,sans-serif';ctx.textAlign='center';
    ctx.fillText(v,x+barW/2,y-6);
    ctx.fillStyle='#888';ctx.font='10px -apple-system,sans-serif';
    ctx.fillText(`Wk ${i+1}`,x+barW/2,H-6);
  });
}

function getAllSecsForWeek(d,w){
  let s=[];
  if(d.hasCardio){
    const opt=state[`w${w}_${d.id}_copt`]||'gym';
    const co=d.cardioOpts.find(o=>o.id===opt);
    if(co)s.push({name:'Cardio',exercises:co.exercises});
  }
  if(d.sections)s=s.concat(d.sections);
  return s;
}

// ‚îÄ‚îÄ‚îÄ SUMMARY PAGE ‚îÄ‚îÄ‚îÄ
function renderSummary(){
  const el=document.getElementById('summaryPage');
  let h=`<div class="wk-row" style="padding:0;margin-bottom:12px">`;
  for(let w=1;w<=4;w++)h+=`<div class="wk-btn ${w===curWeek?'active':''}" onclick="curWeek=${w};render()">Wk ${w}</div>`;
  h+=`</div>`;

  // Completion stats
  let totalEx=0,doneEx=0,totalSets=0,doneSets=0;
  const dayStats=[];
  DAYS.forEach(d=>{
    if(d.isRest)return;
    const secs=getAllSecsForWeek(d,curWeek);
    let dt=0,dd=0,st=0,sd=0;
    secs.forEach((sec,si)=>{
      sec.exercises.forEach((ex,ei)=>{
        dt++;totalEx++;
        if(state[k(curWeek,d.id,si,ei,'done')]){dd++;doneEx++}
        if(ex.sets>1){
          for(let s=1;s<=ex.sets;s++){st++;totalSets++;if(state[sk(curWeek,d.id,si,ei,s,'done')]){sd++;doneSets++}}
        } else {st++;totalSets++;if(state[k(curWeek,d.id,si,ei,'done')]){sd++;doneSets++}}
      });
    });
    dayStats.push({day:d,ex:dt,exDone:dd,sets:st,setsDone:sd});
  });

  h+=`<div class="sum-card"><div class="sum-title">Week ${curWeek} Overview</div>`;
  h+=`<div class="sum-stat"><span class="label">Exercises Completed</span><span class="value">${doneEx} / ${totalEx}</span></div>`;
  h+=`<div class="sum-stat"><span class="label">Sets Completed</span><span class="value">${doneSets} / ${totalSets}</span></div>`;
  h+=`<div class="sum-stat"><span class="label">Completion</span><span class="value">${totalEx>0?Math.round(doneEx/totalEx*100):0}%</span></div>`;
  h+=`</div>`;

  // Per-day breakdown
  h+=`<div class="sum-card"><div class="sum-title">Day Breakdown</div>`;
  dayStats.forEach(ds=>{
    const pct=ds.ex>0?Math.round(ds.exDone/ds.ex*100):0;
    const color=pct===100?'var(--grn)':pct>0?'var(--acc)':'var(--dim)';
    h+=`<div class="sum-stat"><span class="label">${ds.day.label} ‚Äî ${ds.day.title}</span><span class="value" style="color:${color}">${pct}%</span></div>`;
  });
  h+=`</div>`;

  // Notable weights logged this week
  const logged=[];
  DAYS.forEach(d=>{
    if(d.isRest)return;
    const secs=getAllSecsForWeek(d,curWeek);
    secs.forEach((sec,si)=>{
      sec.exercises.forEach((ex,ei)=>{
        const eName=state[k(curWeek,d.id,si,ei,'customName')]||ex.name;
        let maxWt=0,bestRp='';
        for(let s=1;s<=ex.sets;s++){
          const wt=parseFloat(state[sk(curWeek,d.id,si,ei,s,'wt')])||0;
          const rp=state[sk(curWeek,d.id,si,ei,s,'rp')]||'';
          if(wt>maxWt){maxWt=wt;bestRp=rp}
        }
        if(maxWt>0)logged.push({name:eName,wt:maxWt,rp:bestRp,day:d.label});
      });
    });
  });

  if(logged.length){
    h+=`<div class="sum-card"><div class="sum-title">Top Weights Logged</div>`;
    logged.sort((a,b)=>b.wt-a.wt).slice(0,8).forEach(l=>{
      h+=`<div class="sum-stat"><span class="label">${l.name} <span style="color:var(--dim2)">(${l.day})</span></span><span class="value">${l.wt} lbs √ó ${l.rp||'‚Äî'}</span></div>`;
    });
    h+=`</div>`;
  }

  // PR updates this week
  const prUpdates=[];
  PR_LIFTS.forEach(lift=>{
    const history=state[`pr_${lift.id}`]||[];
    const thisWeek=history.filter(e=>e.week===curWeek);
    if(thisWeek.length){
      const best=Math.max(...thisWeek.map(e=>e.val));
      prUpdates.push({name:lift.name,val:best,unit:lift.unit,target:lift.target});
    }
  });
  if(prUpdates.length){
    h+=`<div class="sum-card"><div class="sum-title">PRs Logged This Week</div>`;
    prUpdates.forEach(p=>{
      const hitTarget=p.target&&p.val>=p.target;
      h+=`<div class="sum-stat"><span class="label">${p.name}</span><span class="value">${p.val} ${p.unit}${hitTarget?'<span class="sum-pr">TARGET HIT!</span>':''}</span></div>`;
    });
    h+=`</div>`;
  }

  el.innerHTML=h;
}

// ‚îÄ‚îÄ‚îÄ BOTTOM BAR ‚îÄ‚îÄ‚îÄ
function updateBot(){
  const fill=document.getElementById('progFill');
  const txt=document.getElementById('progTxt');
  if(curTab!=='workout'){
    fill.style.width='0%';
    txt.textContent=curTab==='pr'?'Log your PRs':curTab==='progress'?'Track trends over time':'Weekly recap';
    return;
  }
  const d=DAYS[curDay];
  if(d.isRest){fill.style.width='0%';txt.textContent='Rest Day';return}
  const secs=getSecs(d);let t=0,dn=0;
  secs.forEach((s,si)=>s.exercises.forEach((e,ei)=>{t++;if(state[k(curWeek,d.id,si,ei,'done')])dn++}));
  const pct=t>0?(dn/t*100):0;
  fill.style.width=pct+'%';
  txt.textContent=`${dn} / ${t} exercises ‚Äî ${Math.round(pct)}%`;
}

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ
load();
const today=new Date().getDay();
const dayMap={1:0,2:1,3:2,4:3,5:4,6:5,0:6};
curDay=dayMap[today]??0;
render();
</script>
</body>
</html>
